String.prototype.hashCode=function(){var a=0,b,c;if(0==this.length)return a;b=0;for(l=this.length;b<l;b++)c=this.charCodeAt(b),a=(a<<5)-a+c,a|=0;return a};function makeid(){for(var a="",b=0;10>b;b++)a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return a}var guid=makeid(),$player={},storage={},me={};preinit();
$(function(){modapi.login(function(a){me=a;crapi.clone(function(a){storage=a;init()})});chrome.runtime.onMessage.addListener(function(a,b,c){"modation-pause"==a.action&&(a.guid!=guid?($player.trigger("pause"),c({status:"paused",guid:guid})):c({status:"ignored",guid:guid}))})});
function preinit(){$player="undefined"==typeof player?$({}):$(player);$.get(chrome.extension.getURL("content.html"),function(a){$("body").append(a)});Opentip.styles.profileTip={target:!0,tipJoint:"left",hideDelay:.5,background:"#eee",borderRadius:3,borderColor:"#ddd",ajaxCallback:function(a){a=$(a).find("#user-info");a.find(".report-user").remove();a.css({width:"350px",margin:0,border:"none"});return a[0].outerHTML}};Opentip.styles.groupTip={target:!0,tipJoint:"left",hideDelay:.5,background:"#eee",
borderRadius:3,borderColor:"#ddd",ajaxCallback:function(a){var b=$(a),c=b.find("#group-info");a="";c.length?(c.find(".join").remove(),c.css({width:"350px",margin:0,border:"none"}),a=c[0].outerHTML):(b=b.find("#main"),a="An unknown error occurred!","-1"!=b.find(".empty").text().toLowerCase().indexOf("private")&&(a=b.find(".empty")[0].outerHTML));return a}};Opentip.lastZIndex=676}
function init(){storage[me.email].recent_tracks&&($("body").hasClass("community")&&$("nav.wrapper a[href='/tracks']").after(' <a class="modation-recent-tracks" href="/tracks/recent">Recent</a>'),location.href.match(/\/tracks\/recent/)&&($("nav.wrapper .current").removeClass("current"),$(".modation-recent-tracks").addClass("current")));storage[me.email].profile_tips&&$('a[href*="/user/"]').not('[href*="/track/"], [href*=youtube]').each(function(a,b){var c=$(b),d=c.children("img")[0],c=$(d?$(d).closest("a"):
c).attr("href");$(d||b).opentip("Just a moment...",{style:"profileTip",ajax:c,ajaxID:c})});storage[me.email].group_tips&&$('a[href*="/group/"]').not('[href*="/tracks"], [href*="/members"], [href*="?page="]').each(function(a,b){var c=$(b),d=c.children("img")[0],c=$(d?$(d).closest("a"):c).attr("href");$(d||b).opentip("Just a moment...",{style:"groupTip",ajax:c,ajaxID:c})});storage[me.email].sticky_sidebars&&sticky_sidebars();storage[me.email].group_mods&&$("div#main:has(.group)").length&&group_mods();
storage[me.email].player_downloads&&player_downloads();location.href.match(/\/group\//)&&watchlist_ui();location.href.match(/\/user\/[\w-]*\/track\//)&&watchlist_ui();if(location.href.match(/\player\//)&&storage[me.email].smart_player)$player.on("play",function(){chrome.runtime.sendMessage({action:"modation-pause-everything",guid:guid})})}function _factory(a){return $(".modation-factory ."+a).clone()}function sticky_sidebars(){$("aside").stick_in_parent({offset_top:10})}
function group_mods(){function a(a,b){c(1,a,b);$(b).parents(".modation-group-mods").nextAll(".list-container").first().children("div.row.group").each(function(b,c){elem=$(this).find("p.last-activity")[0];!("undefined"===typeof elem||0<=elem.innerHTML.indexOf("year")||0<=elem.innerHTML.indexOf("month")||0<=elem.innerHTML.search("([5-9]|[123]\\d) days"))||0<$(this).find("div.admin").length?(node=$(this),node.slideDown(600)):(node=$(this),a?node.slideDown(600):node.slideUp(600))});c(2,1,b)}function b(a,
b){c(2,a,b);$(b).parents(".modation-group-mods").nextAll(".list-container").first().children("div.row.group").each(function(b,c){0===$(this).find("div.admin").length&&(node=$(this),a?node.slideDown(600):node.slideUp(600))});a&&c(1,a,b)}function c(c,e,d){switch(c){case 0:$(d).closest(".old-groups").off("click").on("click",function(){a(e?0:1,this)}).html((e?"Hide":"Show")+" Old Groups");$(d).closest(".admin-groups").off("click").on("click",function(){b(e?0:1,this)}).html((e?"Show Only Admin":"Show All")+
" Groups");break;case 1:$(d).closest(".old-groups").off("click").on("click",function(){a(e?0:1,this)}).html((e?"Hide":"Show")+" Old Groups");break;case 2:$(d).closest(".admin-groups").off("click").on("click",function(){b(e?0:1,this)}).html((e?"Show Only Admin":"Show All")+" Groups")}}function d(a,b){$(b).parents(".modation-group-mods").nextAll(".list-container").first().children("div.row.group").each(function(a,b){isAdmin=0<$(this).find("div.admin").length;img=$(this).find("div.img")[0].outerHTML;
link=$(this).find("a.name")[0].outerHTML;vLastActivity=$(this).find("p.last-activity");lastActivity=0<vLastActivity.length?vLastActivity[0].outerHTML.replace("Last activity ","").replace(" ago",""):"";minifiedContent=img+'<div class="info">'+link+(isAdmin?'<span id="spacer" style="width: 80px; height: 20px; float:right;"></span>':"")+lastActivity;isAdmin&&(adminButton=$(this).find("div.admin a")[0].outerHTML,$(this).find("div.admin").html(adminButton),admin=$(this).find("div.admin")[0].outerHTML,
minifiedContent+=admin+"</div>");$(this).html(minifiedContent)});$(b).parents(".modation-group-mods").nextAll(".list-container").first().find("div.row.group, div.img, div.info, p.last-activity, div.admin").addClass("minified")}$("div#main h2").after(_factory("modation-group-mods"));$(".modation-group-mods").fadeIn(2E3);var g=$(".modation-group-mods");g.find(".old-groups").on("click",function(){a(0,this)});g.find(".admin-groups").on("click",function(){b(0,this)});g.find(".minify-groups").on("click",
function(){d(1,this)})}
function player_downloads(){$('iframe[src*="/player/"]').each(function(){var a=$(this).contents();a.find("span#likes").before('<span id="downloads"><div id="circleG"><div id="circleG_1" class="circleG"></div><div id="circleG_2" class="circleG"></div><div id="circleG_3" class="circleG"></div></div></span>');a.find("span#downloads").fadeIn(500);var b=a.find("a").attr("href");$.get(b,function(b){a.find(".circleG").fadeOut(200,function(){$(this).remove();var d='<span id="downloads_count" style="display: none">'+$(b).find("span.downloads").text()+
"</span>";a.find("span#downloads").html(d);a.find("#downloads_count").fadeIn(200)})})})}
function super_pages(a,b){function c(c,g){"undefined"==typeof g&&(g=!0);$(a+", nav.pagination").addClass("disabled");$.get(c,function(h){var e=$(h);h=e.find(a);e=e.find("nav.pagination");$(a).html(h.contents());$("nav.pagination").html(e.contents());g&&history.pushState({id:b},"",c);super_pages(a,b);$(a+", nav.pagination").removeClass("disabled")})}$("nav.pagination").length&&(addCSS($(document),".disabled { pointer-events: none; -webkit-user-select: none; -webkit-filter: grayscale(1) opacity(.6); transition: all .3s; } "+a+
" { transition: all .3s; }",b+"-cover-css"),$("nav.pagination a").each(function(){var a=$(this).attr("href");$(this).click(function(b){c(a);b.preventDefault()})}),$(window).on("popstate."+b,function(a){c(location.href,!1)}))}
function watchlist_ui(){function a(a){a?($(".modation_watch").off("click"),$(".modation_watch").html("Unwatch"),$(".modation_watch").click(function(){c()})):($(".modation_watch").off("click"),$(".modation_watch").html("Watch"),$(".modation_watch").click(function(){b()}))}function b(){var b=storage,c=!0;$.each(b[f].watchlist,function(a,b){return b.link==e?c=!1:!0});c&&(b[f].watchlist.push({link:e,title:k}),a(!0),crapi.update(f,b[f]))}function c(){var b=storage,c=!1;$.each(b[f].watchlist,function(a,
d){return d.link==e?(b[f].watchlist.splice(a,1),c=!0,!1):!0});c&&(a(!1),crapi.update(f,b[f]))}function d(){var a=storage,b=!1;$.each(a[f]["watchlist-queue"],function(c,d){if(d.link==e){var g=a[f].watchlist[d.index],h;for(h in d.state)g[h]=d.state[h];a[f].watchlist[d.index]=g;a[f]["watchlist-queue"].splice(c,1);b=!0;return!1}return!0});b&&(console.info("Modation :: Queue cleared!"),crapi.update(f,a[f]))}var g=location.href.match(/\/group\//),h=location.href.match(/\/user\/[\w-]*\/track\//),e=location.href.replace("http://soundation.com/",
"").split("?")[0],k="Title",f=me.email,m=function(a){var b=!1;$.each(storage[f].watchlist,function(c,d){return d.link==a?(b=!0,!1):!0});return b}(e),n=function(a){var b=!1;$.each(storage[f]["watchlist-queue"],function(c,d){return d.link==a?(b=!0,!1):!0});return b}(e);h?k=$("#main .title").text():g&&(k=$("#group-info h2").html());(function(){$button=_factory("modation_watch");g&&($("#group-info .join").append("<br>").append($button),$(".modation_watch").css("float","right"));h&&$("#main .title").append($button);
m?($(".modation_watch").off("click"),$(".modation_watch").html("Unwatch"),$(".modation_watch").click(function(){c()})):($(".modation_watch").off("click"),$(".modation_watch").html("Watch"),$(".modation_watch").click(function(){b()}));n&&d()})()};
